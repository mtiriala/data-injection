apiVersion: 1

groups:
  - name: burst-erreurs
    orgId: 1
    folder: data-alerts
    interval: 1m
    rules:
      - uid: burst-erreurs-source
        title: "Burst d'erreurs par source"
        condition: A
        data:
          - refId: A
            queryType: ""
            relativeTimeRange:
              from: 600
              to: 0
            datasourceUid: "Loki"
            model:
              expr: 'sum by (source) (count_over_time({job="kafka-logs", etat="FAILED"}[10m])) or vector(0)'
              intervalMs: 1000
              maxDataPoints: 43200
        noDataState: OK
        execErrState: OK
        for: 2m
        annotations:
          description: "Source {{$labels.source}} génère >3 erreurs en 10min - burst détecté"
          summary: "Burst d'erreurs concentré - investigation requise"
        labels:
          severity: critical
          team: data-engineering
          alert_type: burst
        is_paused: false